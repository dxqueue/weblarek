# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

### Данные

#### Товар (IProduct)
```typescript
interface IProduct {
    id: string;            // Уникальный идентификатор товара
    title: string;         // Назавание товара
    image: string;         // URL (Uniform Resource Locator) — уникальный адрес изображения товара
    category: ICategory;   // Категория товара
    price: number | null;  // Цена товара
    description: string;   // Описание товара
}
```

#### Категории товаров (ICategory)
```typescript
type ICategory = 'другое' | 'софт-скил' | 'хард-скил' | 'кнопка' | 'дополнительное';
```

#### Покупатель (IBuyer)
```typescript
interface IBuyer {
    payment: IPayment;  //  Способ оплаты
    address: string;    //  Адрес доставки
    email: string;      //  Электронная почта покупателя
    phone: string;      //  Телефон покупателя
 }
```

#### Способы оплаты товара (IPayment)
```typescript
type IPayment = 'card' | 'cash';
```

### Модели данных

#### Класс ProductCatalog
Отвечает за управление всем, что связано с товарами: хранит их полный список, запоминает, какой товар выбран для просмотра, и дает методы для работы с каталогом.

Конструктор класса не принимает параметров.

Поля класса:
`catalog: IProduct[]` - хранит каталог товаров, полученный с сервера.
`cardProduct: IProduct | null` - хранит выбранную карточку товара для отображения в popup (имеет значение null, если товар не выбран).

Методы класса:
`setCatalog(items: IProduct[]):void` - сохранение каталога товаров в модели.
`getCatalog():IProduct[]` - получение каталога товаров из модели.
`getProduct(id: strig):IProduct | null` - получение выбранного товара по уникальному идентификатору (имеет значение null, если товар не найден).
`setCardProduct(item: IProduct):void` - сохранение выбранного товара для отображения.
`getCardProduct():IProduct | null` - получение выбранного товара для отображения (имеет значение null, если товар не выбран).

#### Класс Basket
Этот класс управляет товарами, которые находятся в корзине: добавление товара в корзину, удаление товара из корзины, подсчет общей стоимости товаров в корзине, и дает методы для работы в корзиной.

Конструктор класса не принимает параметров.

Поля класса:
`items: IProduct[]` - хранит массив товаров, которые были выбраны покупателем и добавлены в корзину.

Методы класса:
`addInBasket(product: IProduct):void` - добавление выбранного товара в корзину.
`removeFromBasket(product: IProduct):void` - удаление выбранного товара из корзины.
`getBasketCount():number` - получение количества товаров, находящихся в корзине.
`getBasketTotal():number` - получение общей стоимость товаров, находящихся в корзине.
`hasInBasket(id: string):boolean` - проведение проверки наличия товара в корзине по его уникальному идентификатору.
`getBasket():IProduct[]` - поулчение списка товаров, находящихся в корзине.
`clearBasket():void` - удаление всех товаров из корзины.

#### Класс Buyer
Этот класс управляет данными покупателя: адрес доставки, электронная почта, телефон, способ оплаты.

Конструктор класса не принимает параметров.

Поля класса:
`payment: IPayment` - способ оплаты товара.
`address: string` - адрес доставки товара.
`email: string` - электронная почта покупателя.
`phone: string` - телефон покупателя.

Методы класса:
`setBuyerData(data: IBuyer):void` - сохранение данных покупателя.
`getBuyerData():IBuyer` - поулчение данных покупателя.
`validateData():boolean` - проверка даных покпателя.
`clearBuyerData():void` - удаление данных покупателя.

### Слой коммуникации

#### Класс LarekApi
Этот класс предоставляет методы для работы с сервером посредством запросов.

Конструктор:
`cdn: string` - URL для медиазапросов.
`baseUrl: string` - URL сервера.

Методы класса:
`getProductList():Promise<IProduct[]>` - получение полного списка товаров.
`getProduct(id: string):Promise<IProduct>` - получение товара по его уникальному идентификатору.
`orderProducts(order: IOrderRequest): Promise<IOrderResponse>` - отправление заказа на сервер.

### Слой представления

#### Класс Card
Базовый абстрактный класс карточки товара.

Конструктор:
`container: HTMLElement` - контейнер DOM-элемента карточки товара.

Поля класса:
`protected cardTitle: HTMLElement` - элемент для отображения названия товара.
`protected cardPrice: HTMLElement` - элемент для тображения цены товара.

Методы класса:
`set title(value: string)` - установка названия товара в соовтетствующий элемент разметкию
`set price(value: number | null)` - установка цены товара в соответствующий элемент разметки. Если передано null - "Бесценно".

#### Класс CardBasket
Класс, описывающий карточку товара в корзине. Использует для расширения класс Card.

Конструктор:
`constructor(containder: HTMLElement, actions?: ICardBasketActions)` - контейнер DOM-элемента карточки товара и опционально обработчик событий.

Поля класса:
`protected cardIndex: HTMLElement` - элемент для отображения номера товара в корзине.
`protected cardButtonDelete: HTMLButtonElement` - элемент для отображения кнопки удаления карточки из корзины.

Методы класса:
`set index(value: number)` - установка номера товара в корзине.

#### Класс CardCatalog
Класс, описывающий карточку товара в каталоге. Использует для расширения класс Card.

Конструктор:
`constructor(container: HTMLElement, actions?: ICardActions)` - контейнер DOM-элемента карточки товара и опционально обработчик событий.

Поля класса:
`protected cardImage: HTMLImageElement` - элемент для отображения изображения товара.
`protected cardCategory: HTMLElement` - элемент для отображения категории товара.

Методы класса:
`set image(value: string)` - устанвока изображения товара.
`set category(value: string)` - установка категории товара.

#### Класс CardView
Класс, описывающий предпросмотр товара. Использует для расширения класс Card.

Конструктор:
`constructor(container: HTMLElement, actions?: ICardActions)` - контейнер DOM-элемента карточки товара и опционально обработчик событий.

Поля класса:
`protected cardImage: HTMLImageElement` - элемент для отображения изображения товара.
`protected cardCategory: HTMLElement` - элемент для отображения категории товара.
`protected cardDescription: HTMLElement` - элемент для отображения описания товара.
`protected cardButton: HTMLButtonElement` - элемент для отображения кнопки добавления/удаления товара в/из корзину.
`protected inBasket: boolean = false` - установка наличия товара в корзине.

Методы класса:
`set image(value: string)` - установка изображения товара.
`set category(value: string)` - устанвока категории товара.
`set description(value: string)` - установка описания твоара.
`set buttonText(value: string)` - устанвока подписи на кнопке добавления товара в корзину.
`set buttonDisabled(value: boolean)` - установка состояни кнопки добавления товара в корзину.

#### Класс BasketView
Класс представления корзины товара. Отвечает за отображение общей стоимости и списка товаров в корзине.

Конструктор:
`constructor(container: HTMLElement, actions?: IBasketActions)` - контейнер DOM-элемента карточки товара и опционально обработчик событий.

Поля класса:
`protected basketTitle: HTMLElement` - элемент для отображения названия товара в корзине.
`protected basketList: HTMLElement` - элемент для отображения списка товаров в корзине.
`protected basketButton: HTMLButtonElement` - элемент для отображения кнопки оформления заказа.
`protected basketPrice: HTMLElement` - элемент для отображения общей стоимости товаров в корзине.

Методы класса:
`set items(value: HTMLElement[])` - устанвока товаров в корзине.
`set buttonText(value: string)` - установка описания на кнопке оформления заказа в корзине.
`set buttonDisabled(value: boolean)` - устанвока состояния кнопки оформления заказа в корзине.
`set total(value: number)` - установка общей стоимости товаров в корзине.

#### Класс Gallery
Класс, отвечающий за отображение каталога товаров на главной странице.

Конструктор:
`constructor(container: HTMLElement)` - контейнер для размещения галереи.

Поля класса:
`protected catalogElement: HTMLElement` - контейнер для отображения элементов каталога.

Методы класса:
`set catalog(items: HTMLElement[])` - устанвока элементов каталога в галерею.

#### Класс Header
Класс, отвечающий за отображение счетчика товаров в корзине и открытие корзины из шапки сайта.

Конструктор:
`constructor(container: HTMLElement, protected events: IEvents)` - контейнер для размещения шапки сайта и обработчик событий.

Поля класса:
`protected counterElement: HTMLElement` - элемент для отображения количества товаров в корзине.
`protected basketButton: HTMLButtonElement` - элемент для отображения корзины с товарами.

Методы класса:
`set counter(value: number)` - устанвока счетчика товаров в корзине.

#### Класс Modal
Класс, отвечающий за отображение модального окна.

Конструктор:
`constructor(container: HTMLElement, protected events: IEvents)` - контейнер для размещения модального окна и обработчик событий.

Поля класса:
`protected modalButton: HTMLButtonElement` - элемент для отображения кнопки закрытия модального окна.
`protected modalElement: HTMLElement` - элемент для отображения контента внутри модального окна.
`protected page: HTMLElement` - элемент страницы, необходимый для установки запрета скролла во время открытия модального окна.
`protected isOpen = false` - устанвока состояния модального окна.

Методы класса:
`set content(value: HTMLElement)` - установка содержимого моадльного окна.
`open(): void` - открывает моадльное окно.
`close(): void` - закрывает моадльное окно.
`render(data?: Partial<{content: HTMLElement}>): HTMLElement` - установка рендера отображения в модальном окне.

#### Класс Success
Класс, отвечающий за успешное оформление заказа.

Конструктор:
`constructor(container: HTMLElement, actions?: ISuccessActions)` - контейнер для отображения модального окна и обработчик событий.

Поля класса:
`protected successDescription: HTMLElement` - элемент для отображения описания в моадльном окне.
`protected successButton: HTMLButtonElement` - элемент для отображения кнопки закрытия модального окна.

Методы класса:
`set total(value: number)` - установка текста с информацией о стоимости завршенного заказа.

#### Класс Form
Абстрактный базовый класс формы. Определяет общую структуру и поведение для всех типов форм в приложении.

Конструктор:
`constructor(container: HTMLElement, actions?: IFormActions)` - контейнер формы и обработчик событий.

Поля класса:
`protected errorsElement: HTMLElement` - элемент для отображения ошибок валидации.
`protected submitButton: HTMLButtonElement` - элемент для отображения кнопки отправки формы.

Методы класса:
`set valid(value: boolean)` - управление состоянием кнопки отправки формы (активна/неактивна) в зависимости от валидности данных.
`set errors(value: string)` - установка текста ошибок валидации формы.
`clearErrors(): void` - очистка текста ошибки.
`setValidationErrors(errors: {[key: string]: string}): void` - устанвока ошибки валидации и обновление статуса валидации.

#### Класс FormContacts
Класс, отображающий контактные данные покупателя.

Конструктор:
`constructor(container: HTMLElement, actions?: IFormContactsActions)` - контейнер формы и обработчик событий.

Поля класса:
`protected emailInput: HTMLInputElement` - элемент для отображения поля ввода email покупателя.
`protected phoneInput: HTMLInputElement` - элемент для отображения поля вооду телефона покупателя.

Методы класса:
`set email(value: string)` - установка значения email в соответствующее поле ввода.
`set phone(value: string)` - установка значения телефона в соответствующее поле ввода.
`get email(): string` - поулчение данных: email.
`get phone(): string` - поулчение данных: телефон.
`get formData(): IFormContactsData` - получение объекта данных формы.

#### Класс FormOrder
Класс, отображающий форму оформления заказа.

Конструктор:
`constructor(container: HTMLElement, actions?: IFormOrderActions)` - контейнер формы и обработчик событий.

Поля класса:
`protected paymentButtons: HTMLButtonElement[]` - элемент для отображения выбора способа оплаты.
`protected addressInput: HTMLInputElement` - элемент для отображения поля воода адреса доставки.

Методы класса:
`set payment(value: TPayment)` - установка активного способа оплаты с визуальным выделением выбранной кнопки.
`set address(value: string)` - установка значения адреса доставки в поле ввода.
`get payment(): TPayment` - получение способа оплаты.
`get address(): string` - получение данных: адрес.
`get formData(): IFormOrderData` - получение объекта данных формы.
`selectPayment(payment: TPayment): void` - 
 
 ### События приложения

 `catalog:changed` - Событие изменения списка товаров.
 `card:selected` - Событие клика по карточке из каталога.
 `card:add` - Событие добавление товара в корзину.
 `card:remove` - Событие удаление товара из корзины, когда пользователь находится в карточке товара.
 `basket:open` - Событие открытия корзины.
 `basket:order` - Событие оформления заказа.
 `basket:card:remove` - Событие удаления товара из корзины, когда пользователь находится в корзине.
 `basket:changed` - Событие изменения списка товаров в корзине.
 `buyer:changed` - Событие изменения данных покупателя.
 `order:submit` - Событие отправки формы с адресом и способом оплаты.
 `modal:close` -  Событие закрытия модального окна.
 `contacts:submit` - Событие отправки формы с email и телефоном.

 ### Слой презентера
 Презентер реализован в основном файле main.ts и использует событийную модель. Компоненты приложения общаются через события, что делает их менее связанными друг с другом, а вся логика сосредоточена в презентере.

Презентер отвечает за:
 - Создание моделей (каталога, корзины, покупателя) и подключение их к системе событий.
 - Настройку всех элементов интерфейса и назначение обработчиков действий пользователя.
 - Отслеживание изменений в данных и автоматическое обновление интерфейса.
 - Обработку пользовательских действий с вызовом соответствующих методов моделей.

_Архитектурное решение:_ Презентер реализован непосредственно в main.ts как набор функций, что упрощает код сохраняя все преимущества MVP-паттерна.